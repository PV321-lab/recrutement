<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Enregistrement Invité</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f0f2f5;
  padding:10px;
}

.card{
  background:#fff;
  padding:15px;
  border-radius:10px;
  max-width:600px;
  margin:auto;
  box-shadow:0 2px 8px rgba(0,0,0,.2);
}

label{
  font-weight:bold;
  margin-top:10px;
  display:block;
}

input,button{
  width:100%;
  padding:8px;
  margin-top:5px;
}

button{
  background:#1E40AF;
  color:white;
  border:none;
  border-radius:6px;
  margin-top:15px;
  cursor:pointer;
}

.reglement{
  font-size:11px;
  line-height:1.3;
  border:1px solid #ccc;
  padding:8px;
  background:#fafafa;
  max-height:230px;
  overflow:auto;
  margin-top:10px;
}

canvas{
  border:1px solid #999;
  border-radius:5px;
  margin-top:5px;
}

.banner{
  padding:10px;
  margin-bottom:10px;
  border-radius:6px;
  font-weight:bold;
}

.warn{background:#fff3cd;}
.ok{background:#d4edda;}
</style>
</head>

<body>

<div class="card">

<h3>Enregistrement Invité</h3>

<div id="msg" class="banner" style="display:none"></div>

<label>Appartement</label>
<input type="text" id="appart" value="12" readonly>

<label>Immeuble</label>
<input type="text" id="bat" value="A" readonly>

<label>Date d'arrivée *</label>
<input type="date" id="date">

<label>Nom complet *</label>
<input type="text" id="nom">

<label>Document *</label>
<input type="text" id="doc">

<div class="reglement">
<b>1. Couples marocains</b><br>
Seuls les couples marocains légalement mariés sont acceptés.<br><br>

<b>2. Tranquillité et bruit</b><br>
Silence total après 23h00. Aucun bruit à toute heure.<br><br>

<b>3. Tabagisme</b><br>
Interdit à l’intérieur. Autorisé uniquement à l’extérieur.<br><br>

<b>4. Nombre de personnes</b><br>
Maximum 5 personnes. Aucune visite après 22h00.<br><br>

<b>5. Piscine</b><br>
Douche obligatoire. Pas de verre. Enfants sous surveillance.
Fermeture à 20h00. Pas de plongeons.<br><br>

<b>6. Propreté</b><br>
Maintenir les lieux propres.<br><br>

En acceptant ce règlement, vous confirmez l’avoir lu et compris.
</div>

<label style="display:flex;align-items:center;margin-top:8px">
<input type="checkbox" id="accept" style="width:auto;margin-right:6px">
J’accepte le règlement
</label>

<label>Signature du client *</label>
<canvas id="signature" width="300" height="120"></canvas>
<button type="button" onclick="clearSignature()">Effacer la signature</button>

<button onclick="valider()">Valider & Générer PDF</button>

</div>

<script>
const canvas = document.getElementById("signature");
const ctx = canvas.getContext("2d");
let drawing=false;
let signed=false;

canvas.addEventListener("mousedown",e=>{
  drawing=true; signed=true;
  ctx.beginPath();
  ctx.moveTo(e.offsetX,e.offsetY);
});
canvas.addEventListener("mousemove",e=>{
  if(!drawing) return;
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
});
canvas.addEventListener("mouseup",()=>drawing=false);
canvas.addEventListener("mouseleave",()=>drawing=false);

function clearSignature(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  signed=false;
}

function show(type,text){
  const m=document.getElementById("msg");
  m.className="banner "+type;
  m.textContent=text;
  m.style.display="block";
}

function valider(){
  if(!accept.checked){
    show("warn","Vous devez accepter le règlement.");
    return;
  }
  if(!signed){
    show("warn","Signature obligatoire.");
    return;
  }
  if(!nom.value || !doc.value || !date.value){
    show("warn","Tous les champs sont obligatoires.");
    return;
  }

  generatePDF();
  show("ok","PDF généré avec succès.");
}

function generatePDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  pdf.setFontSize(12);
  pdf.text("FICHE D'INVITÉ",10,10);
  pdf.text(`Nom : ${nom.value}`,10,20);
  pdf.text(`Document : ${doc.value}`,10,28);
  pdf.text(`Appartement : ${appart.value}`,10,36);
  pdf.text(`Immeuble : ${bat.value}`,10,44);
  pdf.text(`Date : ${date.value}`,10,52);

  pdf.text("Signature du client :",10,65);
  pdf.addImage(canvas.toDataURL(),"PNG",10,70,80,35);

  pdf.save("invitation_signee.pdf");
}
</script>

</body>
</html>