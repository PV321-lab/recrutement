<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Enregistrement des invit√©s</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* üîí STYLE IDENTIQUE ‚Äì inchang√© */
body { font-family: Arial, sans-serif; margin:16px; background:#f0f2f5; }
.hidden{ display:none; }
button{ padding:10px; border:none; background:#007bff; color:#fff; cursor:pointer; }
.banner{ padding:10px; margin:10px 0; border-radius:8px; }
.banner.ok{ background:#d4edda; }
.banner.err{ background:#f8d7da; }
.banner.warn{ background:#fff3cd; }
.banner.info{ background:#cce5ff; }
.card{ background:#fff; padding:16px; border-radius:10px; margin-bottom:16px; }
input{ width:100%; padding:10px; margin-top:6px; }
</style>
</head>

<body>

<h2>Enregistrement des invit√©s</h2>
<div id="banner" class="banner hidden"></div>

<!-- LOGIN -->
<div id="loginCard" class="card">
  <label>Utilisateur (email Firebase)</label>
  <input id="loginUser" type="email" placeholder="email" />
  <label>Mot de passe</label>
  <input id="loginPass" type="password" placeholder="mot de passe" />
  <button onclick="login()">Connexion</button>
  <div id="loginMsg" class="banner err hidden"></div>
</div>

<!-- ADMIN -->
<div id="adminPanel" class="hidden">
  <div class="card">
    <strong>Admin</strong>
    <button onclick="logout()">D√©connexion</button>
  </div>
</div>

<!-- USER -->
<div id="userPanel" class="hidden">
  <div class="card">
    <strong>Utilisateur</strong>
    <button onclick="logout()">D√©connexion</button>
  </div>
</div>

<script>
/* ==============================
   üî• FIREBASE CONFIG (NOUVEAU)
================================ */
const firebaseConfig = {
  apiKey: "AIzaSyC6uSDTNCuw5sHNVaNgq0EzJqJZ9jgic7U",
  authDomain: "dddiii-2b58b.firebaseapp.com",
  databaseURL: "https://dddiii-2b58b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "dddiii-2b58b",
  storageBucket: "dddiii-2b58b.firebasestorage.app",
  messagingSenderId: "721468171485",
  appId: "1:721468171485:web:420e2e0ab98b95fa2ae734",
  measurementId: "G-QGFM2N76VK"
};

firebase.initializeApp(firebaseConfig);

const database = firebase.database();
const auth = firebase.auth();

let currentUser = null;

/* ==============================
   UI HELPERS
================================ */
function showBanner(type, text){
  const b = document.getElementById('banner');
  b.className = 'banner ' + type;
  b.textContent = text;
  b.classList.remove('hidden');
}
function hideBanner(){
  document.getElementById('banner').classList.add('hidden');
}

/* ==============================
   üîê LOGIN AVEC FIREBASE AUTH
================================ */
async function login(){
  const email = document.getElementById('loginUser').value.trim();
  const pass  = document.getElementById('loginPass').value.trim();

  if(!email || !pass){
    showBanner('warn','Email et mot de passe requis');
    return;
  }

  try {
    // üîê AUTH FIREBASE
    await auth.signInWithEmailAndPassword(email, pass);

    // üîé LOGIQUE EXISTANTE
    if(email === "admin@admin.com"){
      currentUser = { role:'admin' };
      document.getElementById('loginCard').classList.add('hidden');
      document.getElementById('adminPanel').classList.remove('hidden');
      showBanner('ok','Connect√© en tant qu‚Äôadmin');
      return;
    }

    // USER NORMAL (ID = email sans @)
    const userId = email.split('@')[0];
    const snap = await database.ref('users/' + userId).once('value');
    const user = snap.val();

    if(user){
      currentUser = { role:'user', id:userId };
      document.getElementById('loginCard').classList.add('hidden');
      document.getElementById('userPanel').classList.remove('hidden');
      showBanner('ok','Connexion r√©ussie');
    } else {
      showBanner('err','Utilisateur non trouv√© dans la base');
    }

  } catch (e) {
    showBanner('err','Connexion Firebase refus√©e');
  }
}

/* ==============================
   üîì LOGOUT
================================ */
function logout(){
  auth.signOut();
  currentUser = null;
  document.getElementById('adminPanel').classList.add('hidden');
  document.getElementById('userPanel').classList.add('hidden');
  document.getElementById('loginCard').classList.remove('hidden');
  showBanner('info','D√©connect√©');
}
</script>

</body>
</html>