<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartRecrute - Matching Intelligent</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <style>
        :root {
            --primary-color: #3f51b5;
            --secondary-color: #2196f3;
            --accent-color: #4caf50;
            --light-color: #f5f7fa;
            --dark-color: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            background: linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.9)), 
                        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect fill="%233f51b5" opacity="0.1" width="100" height="100"/><path d="M0,0 L100,100" stroke="%232196f3" stroke-width="1" opacity="0.2"/><path d="M100,0 L0,100" stroke="%232196f3" stroke-width="1" opacity="0.2"/></svg>');
            padding: 2rem 0;
            border-radius: 0 0 20px 20px;
            margin-bottom: 2rem;
        }
        
        .card {
            border-radius: 12px;
            border: none;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
            margin-bottom: 1.5rem;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid #eaeaea;
            font-weight: 600;
            padding: 1rem 1.25rem;
            border-radius: 12px 12px 0 0 !important;
        }
        
        .table-responsive {
            border-radius: 8px;
            overflow: hidden;
        }
        
        .table thead th {
            background-color: var(--primary-color);
            color: white;
            border: none;
            font-weight: 500;
            padding: 0.75rem 1rem;
        }
        
        .table tbody tr {
            transition: background-color 0.2s;
        }
        
        .table tbody tr:hover {
            background-color: rgba(63, 81, 181, 0.05);
        }
        
        .match-high {
            background-color: rgba(76, 175, 80, 0.15);
            color: #2e7d32;
            padding: 3px 8px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .match-medium {
            background-color: rgba(255, 193, 7, 0.15);
            color: #f57c00;
            padding: 3px 8px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .match-low {
            background-color: rgba(244, 67, 54, 0.15);
            color: #d32f2f;
            padding: 3px 8px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .tech-badge {
            background-color: #e3f2fd;
            color: var(--primary-color);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin: 2px;
            display: inline-block;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .btn-primary:hover {
            background-color: #303f9f;
            border-color: #303f9f;
        }
        
        .btn-success {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .modal-content {
            border-radius: 12px;
            border: none;
        }
        
        .modal-header {
            background-color: var(--light-color);
            border-radius: 12px 12px 0 0;
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 0.75rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.25rem rgba(33, 150, 243, 0.25);
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .remote-badge {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .onsite-badge {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        
        .footer {
            background-color: var(--dark-color);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
            border-radius: 20px 20px 0 0;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(63, 81, 181, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(63, 81, 181, 0); }
            100% { box-shadow: 0 0 0 0 rgba(63, 81, 181, 0); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-brain"></i> <strong>SmartRecrute</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#offres">Offres</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#candidats">Candidats</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#addOfferModal">
                            <i class="fas fa-plus-circle"></i> Ajouter offre
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#addCandidateModal">
                            <i class="fas fa-user-plus"></i> Ajouter candidat
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- En-tête -->
    <div class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-5 fw-bold text-primary">SmartRecrute</h1>
                    <p class="lead">L'application intelligente de matching entre candidats et offres d'emploi IT</p>
                    <p>Infrastructure, Cloud, DevOps, Administration de bases de données</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-success btn-lg pulse" id="runMatchingBtn">
                        <i class="fas fa-cogs"></i> Lancer le matching IA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenu principal -->
    <div class="container">
        <!-- Section des offres -->
        <section id="offres">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-briefcase text-primary me-2"></i>
                        <span>Offres d'emploi</span>
                    </div>
                    <div>
                        <button class="btn btn-outline-primary btn-sm me-2" id="loadOffersBtn">
                            <i class="fas fa-sync-alt"></i> Charger les offres
                        </button>
                        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addOfferModal">
                            <i class="fas fa-plus"></i> Nouvelle offre
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="offersTable">
                            <thead>
                                <tr>
                                    <th>Intitulé de poste</th>
                                    <th>Emplacement</th>
                                    <th>Salaire/TJM</th>
                                    <th>Technologies</th>
                                    <th>Télétravail</th>
                                    <th>Profils proposés</th>
                                    <th>Matching</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="offersTableBody">
                                <!-- Les offres seront chargées ici -->
                                <tr>
                                    <td colspan="8" class="text-center text-muted py-4">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Cliquez sur "Charger les offres" pour afficher les données
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section des candidats -->
        <section id="candidats">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-users text-primary me-2"></i>
                        <span>Candidats</span>
                    </div>
                    <div>
                        <button class="btn btn-outline-primary btn-sm me-2" id="loadCandidatesBtn">
                            <i class="fas fa-sync-alt"></i> Charger les candidats
                        </button>
                        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addCandidateModal">
                            <i class="fas fa-plus"></i> Nouveau candidat
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="candidatesTable">
                            <thead>
                                <tr>
                                    <th>Nom & Prénom</th>
                                    <th>Téléphone</th>
                                    <th>Email</th>
                                    <th>Profil</th>
                                    <th>Technologies maîtrisées</th>
                                    <th>Offres potentielles</th>
                                    <th>Matching</th>
                                    <th>CV</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="candidatesTableBody">
                                <!-- Les candidats seront chargés ici -->
                                <tr>
                                    <td colspan="9" class="text-center text-muted py-4">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Cliquez sur "Charger les candidats" pour afficher les données
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal pour ajouter une offre -->
    <div class="modal fade" id="addOfferModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ajouter une offre d'emploi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addOfferForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="offerTitle" class="form-label">Intitulé du poste *</label>
                                <input type="text" class="form-control" id="offerTitle" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="offerLocation" class="form-label">Emplacement *</label>
                                <input type="text" class="form-control" id="offerLocation" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="offerSalary" class="form-label">Salaire/TJM *</label>
                                <input type="text" class="form-control" id="offerSalary" placeholder="Ex: 50-60k€ ou 500€/jour" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="offerRemote" class="form-label">Télétravail *</label>
                                <select class="form-select" id="offerRemote" required>
                                    <option value="full">Complet</option>
                                    <option value="partial">Partiel</option>
                                    <option value="none">Non</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="offerTechnologies" class="form-label">Technologies demandées *</label>
                            <input type="text" class="form-control" id="offerTechnologies" placeholder="Séparez par des virgules (AWS, Docker, Kubernetes, PostgreSQL...)" required>
                            <div class="form-text">Listez les technologies, langages et outils requis</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="offerDescription" class="form-label">Description du poste</label>
                            <textarea class="form-control" id="offerDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="offerLink" class="form-label">Lien vers l'offre (LinkedIn, Indeed, etc.) *</label>
                            <input type="url" class="form-control" id="offerLink" placeholder="https://www.linkedin.com/jobs/view/..." required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="offerCompany" class="form-label">Entreprise</label>
                            <input type="text" class="form-control" id="offerCompany">
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Enregistrer l'offre
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour ajouter un candidat -->
    <div class="modal fade" id="addCandidateModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ajouter un candidat</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addCandidateForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="candidateFirstName" class="form-label">Prénom *</label>
                                <input type="text" class="form-control" id="candidateFirstName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="candidateLastName" class="form-label">Nom *</label>
                                <input type="text" class="form-control" id="candidateLastName" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="candidatePhone" class="form-label">Téléphone *</label>
                                <input type="tel" class="form-control" id="candidatePhone" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="candidateEmail" class="form-label">Email *</label>
                                <input type="email" class="form-control" id="candidateEmail" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="candidateDepartment" class="form-label">Département</label>
                                <input type="text" class="form-control" id="candidateDepartment">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="candidateProfile" class="form-label">Profil *</label>
                                <select class="form-select" id="candidateProfile" required>
                                    <option value="Cloud Engineer">Cloud Engineer</option>
                                    <option value="DevOps">DevOps</option>
                                    <option value="Administrateur BDD">Administrateur BDD</option>
                                    <option value="SRE">SRE</option>
                                    <option value="Ingénieur Infrastructure">Ingénieur Infrastructure</option>
                                    <option value="Autre">Autre</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="candidateTechnologies" class="form-label">Technologies maîtrisées *</label>
                            <input type="text" class="form-control" id="candidateTechnologies" placeholder="Séparez par des virgules (AWS, Docker, Kubernetes, PostgreSQL...)" required>
                            <div class="form-text">Listez les technologies, langages et outils que vous maîtrisez</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="candidateCV" class="form-label">Lien vers CV (LinkedIn, PDF, etc.) *</label>
                            <input type="url" class="form-control" id="candidateCV" placeholder="https://www.linkedin.com/in/... ou https://moncv.com/cv.pdf" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="candidateExperience" class="form-label">Années d'expérience</label>
                            <select class="form-select" id="candidateExperience">
                                <option value="0-2">0-2 ans</option>
                                <option value="2-5">2-5 ans</option>
                                <option value="5-10">5-10 ans</option>
                                <option value="10+">10+ ans</option>
                            </select>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Enregistrer le candidat
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour afficher les détails du matching -->
    <div class="modal fade" id="matchingDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="matchingModalTitle">Détails du matching</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="matchingDetailsContent">
                        <!-- Contenu dynamique pour les détails du matching -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pied de page -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="fas fa-brain"></i> SmartRecrute</h5>
                    <p>Application intelligente de matching entre candidats et offres d'emploi IT.</p>
                    <p>Sources: LinkedIn, Monster, Indeed, Fribourg</p>
                </div>
                <div class="col-md-6 text-end">
                    <p>Développé avec <i class="fas fa-heart text-danger"></i> pour le recrutement IT</p>
                    <p>Powered by Firebase & AI Matching</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBv8YrH055qDZhMZFXEq4oUFTZQAM097Ao",
            authDomain: "recrutement-it.firebaseapp.com",
            databaseURL: "https://recrutement-it-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "recrutement-it",
            storageBucket: "recrutement-it.firebasestorage.app",
            messagingSenderId: "665734903354",
            appId: "1:665734903354:web:ff512fca337c362833a703",
            measurementId: "G-LH8Z73HX1C"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // Données de démonstration pour les offres et candidats
        const sampleOffers = [
            {
                id: 1,
                title: "Ingénieur Cloud DevOps",
                location: "Paris",
                salary: "60-75k€",
                technologies: ["AWS", "Docker", "Kubernetes", "Terraform", "Jenkins"],
                remote: "full",
                company: "TechCorp",
                link: "https://www.linkedin.com/jobs/view/123456789",
                proposedProfiles: 0,
                matchPercentage: 0,
                description: "Nous recherchons un ingénieur Cloud DevOps pour rejoindre notre équipe."
            },
            {
                id: 2,
                title: "Administrateur Base de Données",
                location: "Lyon",
                salary: "45-55k€",
                technologies: ["PostgreSQL", "MySQL", "MongoDB", "Redis", "SQL Server"],
                remote: "partial",
                company: "DataSystems",
                link: "https://www.indeed.com/job/admin-bdd",
                proposedProfiles: 0,
                matchPercentage: 0,
                description: "Gestion et optimisation des bases de données critiques."
            },
            {
                id: 3,
                title: "SRE - Site Reliability Engineer",
                location: "Remote",
                salary: "550€/jour",
                technologies: ["Google Cloud", "Kubernetes", "Prometheus", "Grafana", "Python"],
                remote: "full",
                company: "CloudTech",
                link: "https://www.monster.fr/emploi/sre",
                proposedProfiles: 0,
                matchPercentage: 0,
                description: "Assurer la fiabilité et la performance des services cloud."
            }
        ];

        const sampleCandidates = [
            {
                id: 1,
                firstName: "Jean",
                lastName: "Dupont",
                phone: "+33 6 12 34 56 78",
                email: "jean.dupont@email.com",
                department: "Île-de-France",
                profile: "DevOps",
                technologies: ["AWS", "Docker", "Kubernetes", "Terraform", "Linux", "Python"],
                cv: "https://www.linkedin.com/in/jeandupont",
                experience: "5-10",
                potentialOffers: 0,
                matchPercentage: 0
            },
            {
                id: 2,
                firstName: "Marie",
                lastName: "Martin",
                phone: "+33 6 23 45 67 89",
                email: "marie.martin@email.com",
                department: "Rhône-Alpes",
                profile: "Administrateur BDD",
                technologies: ["PostgreSQL", "MySQL", "Oracle", "MongoDB", "SQL"],
                cv: "https://marie-martin-cv.com",
                experience: "10+",
                potentialOffers: 0,
                matchPercentage: 0
            },
            {
                id: 3,
                firstName: "Ahmed",
                lastName: "Benali",
                phone: "+33 6 34 56 78 90",
                email: "ahmed.benali@email.com",
                department: "Provence-Alpes-Côte d'Azur",
                profile: "Cloud Engineer",
                technologies: ["AWS", "Azure", "Docker", "Kubernetes", "Terraform", "Ansible"],
                cv: "https://www.linkedin.com/in/ahmedbenali",
                experience: "2-5",
                potentialOffers: 0,
                matchPercentage: 0
            }
        ];

        // Variables globales
        let offers = [];
        let candidates = [];
        let currentMatchingResults = [];

        // Initialiser l'application
        document.addEventListener('DOMContentLoaded', function() {
            // Charger les données depuis Firebase au démarrage
            loadOffers();
            loadCandidates();
            
            // Événements pour les boutons
            document.getElementById('loadOffersBtn').addEventListener('click', loadOffers);
            document.getElementById('loadCandidatesBtn').addEventListener('click', loadCandidates);
            document.getElementById('runMatchingBtn').addEventListener('click', runMatching);
            
            // Gestion des formulaires
            document.getElementById('addOfferForm').addEventListener('submit', addOffer);
            document.getElementById('addCandidateForm').addEventListener('submit', addCandidate);
            
            // Afficher un message de bienvenue
            showNotification('SmartRecrute est prêt ! Chargez les données pour commencer.', 'success');
        });

        // Charger les offres depuis Firebase
        function loadOffers() {
            const btn = document.getElementById('loadOffersBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="loading"></span> Chargement...';
            btn.disabled = true;
            
            // Dans une vraie application, on chargerait depuis Firebase
            // Pour la démo, on utilise des données simulées
            setTimeout(() => {
                offers = [...sampleOffers];
                renderOffersTable();
                btn.innerHTML = originalText;
                btn.disabled = false;
                showNotification(`${offers.length} offres chargées avec succès`, 'success');
            }, 800);
        }

        // Charger les candidats depuis Firebase
        function loadCandidates() {
            const btn = document.getElementById('loadCandidatesBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="loading"></span> Chargement...';
            btn.disabled = true;
            
            // Dans une vraie application, on chargerait depuis Firebase
            // Pour la démo, on utilise des données simulées
            setTimeout(() => {
                candidates = [...sampleCandidates];
                renderCandidatesTable();
                btn.innerHTML = originalText;
                btn.disabled = false;
                showNotification(`${candidates.length} candidats chargés avec succès`, 'success');
            }, 800);
        }

        // Afficher les offres dans le tableau
        function renderOffersTable() {
            const tbody = document.getElementById('offersTableBody');
            tbody.innerHTML = '';
            
            if (offers.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center text-muted py-4">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            Aucune offre disponible. Ajoutez-en une !
                        </td>
                    </tr>
                `;
                return;
            }
            
            offers.forEach(offer => {
                const remoteBadge = offer.remote === 'full' 
                    ? '<span class="status-badge remote-badge">Télétravail complet</span>'
                    : offer.remote === 'partial' 
                    ? '<span class="status-badge remote-badge">Télétravail partiel</span>'
                    : '<span class="status-badge onsite-badge">Sur site</span>';
                
                const matchClass = getMatchClass(offer.matchPercentage);
                const matchBadge = offer.matchPercentage > 0 
                    ? `<span class="${matchClass}">${offer.matchPercentage}%</span>`
                    : '<span class="text-muted">Non calculé</span>';
                
                const techBadges = offer.technologies.map(tech => 
                    `<span class="tech-badge">${tech}</span>`
                ).join('');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <strong>${offer.title}</strong>
                        ${offer.company ? `<div class="small text-muted">${offer.company}</div>` : ''}
                    </td>
                    <td>${offer.location}</td>
                    <td>${offer.salary}</td>
                    <td>${techBadges}</td>
                    <td>${remoteBadge}</td>
                    <td>
                        <span class="badge bg-primary rounded-pill">${offer.proposedProfiles}</span>
                    </td>
                    <td>${matchBadge}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewOfferDetails(${offer.id})" title="Voir détails">
                            <i class="fas fa-eye"></i>
                        </button>
                        <a href="${offer.link}" target="_blank" class="btn btn-sm btn-outline-info" title="Voir l'offre">
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Afficher les candidats dans le tableau
        function renderCandidatesTable() {
            const tbody = document.getElementById('candidatesTableBody');
            tbody.innerHTML = '';
            
            if (candidates.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center text-muted py-4">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            Aucun candidat disponible. Ajoutez-en un !
                        </td>
                    </tr>
                `;
                return;
            }
            
            candidates.forEach(candidate => {
                const matchClass = getMatchClass(candidate.matchPercentage);
                const matchBadge = candidate.matchPercentage > 0 
                    ? `<span class="${matchClass}">${candidate.matchPercentage}%</span>`
                    : '<span class="text-muted">Non calculé</span>';
                
                const techBadges = candidate.technologies.map(tech => 
                    `<span class="tech-badge">${tech}</span>`
                ).join('');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <strong>${candidate.firstName} ${candidate.lastName}</strong>
                        <div class="small text-muted">${candidate.profile}</div>
                    </td>
                    <td>${candidate.phone}</td>
                    <td>${candidate.email}</td>
                    <td>${candidate.profile}</td>
                    <td>${techBadges}</td>
                    <td>
                        <span class="badge bg-primary rounded-pill">${candidate.potentialOffers}</span>
                    </td>
                    <td>${matchBadge}</td>
                    <td>
                        <a href="${candidate.cv}" target="_blank" class="btn btn-sm btn-outline-success" title="Voir CV">
                            <i class="fas fa-file-pdf"></i> CV
                        </a>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewCandidateDetails(${candidate.id})" title="Voir détails">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Exécuter l'algorithme de matching IA
        function runMatching() {
            if (offers.length === 0 || candidates.length === 0) {
                showNotification('Veuillez charger à la fois des offres et des candidats', 'warning');
                return;
            }
            
            const btn = document.getElementById('runMatchingBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="loading"></span> Analyse IA en cours...';
            btn.disabled = true;
            
            // Simuler un traitement IA
            setTimeout(() => {
                // Réinitialiser les compteurs
                offers.forEach(offer => {
                    offer.proposedProfiles = 0;
                    offer.matchPercentage = 0;
                });
                
                candidates.forEach(candidate => {
                    candidate.potentialOffers = 0;
                    candidate.matchPercentage = 0;
                });
                
                // Calculer les matchings
                currentMatchingResults = [];
                
                candidates.forEach(candidate => {
                    let bestMatch = 0;
                    let candidateOffers = 0;
                    
                    offers.forEach(offer => {
                        const matchScore = calculateMatchScore(candidate, offer);
                        
                        if (matchScore > 40) { // Seuil de 40% pour considérer un matching
                            candidateOffers++;
                            offer.proposedProfiles++;
                            
                            // Enregistrer le matching pour affichage détaillé
                            currentMatchingResults.push({
                                candidateId: candidate.id,
                                candidateName: `${candidate.firstName} ${candidate.lastName}`,
                                offerId: offer.id,
                                offerTitle: offer.title,
                                matchScore: matchScore,
                                matchingFactors: analyzeMatchingFactors(candidate, offer)
                            });
                        }
                        
                        if (matchScore > bestMatch) {
                            bestMatch = matchScore;
                        }
                    });
                    
                    candidate.potentialOffers = candidateOffers;
                    candidate.matchPercentage = bestMatch;
                });
                
                // Calculer le meilleur match pour chaque offre
                offers.forEach(offer => {
                    let bestMatch = 0;
                    
                    candidates.forEach(candidate => {
                        const matchScore = calculateMatchScore(candidate, offer);
                        if (matchScore > bestMatch) {
                            bestMatch = matchScore;
                        }
                    });
                    
                    offer.matchPercentage = bestMatch;
                });
                
                // Mettre à jour les tableaux
                renderOffersTable();
                renderCandidatesTable();
                
                // Afficher les résultats
                showMatchingResults();
                
                btn.innerHTML = originalText;
                btn.disabled = false;
                
                showNotification(`Matching IA terminé : ${currentMatchingResults.length} correspondances trouvées`, 'success');
            }, 1500);
        }

        // Calculer le score de matching entre un candidat et une offre
        function calculateMatchScore(candidate, offer) {
            let score = 0;
            
            // 1. Correspondance des technologies (50% du score)
            const candidateTechs = candidate.technologies.map(t => t.toLowerCase());
            const offerTechs = offer.technologies.map(t => t.toLowerCase());
            
            const commonTechs = offerTechs.filter(tech => 
                candidateTechs.some(cTech => cTech.includes(tech) || tech.includes(cTech))
            );
            
            const techMatch = offerTechs.length > 0 
                ? (commonTechs.length / offerTechs.length) * 50 
                : 0;
            
            score += techMatch;
            
            // 2. Correspondance du profil (20% du score)
            const profileKeywords = {
                "Cloud Engineer": ["cloud", "aws", "azure", "gcp", "devops"],
                "DevOps": ["devops", "ci/cd", "docker", "kubernetes", "terraform"],
                "Administrateur BDD": ["database", "sql", "postgresql", "mysql", "oracle", "mongodb"],
                "SRE": ["sre", "reliability", "monitoring", "incident", "on-call"],
                "Ingénieur Infrastructure": ["infrastructure", "network", "system", "linux", "windows server"]
            };
            
            const candidateProfile = candidate.profile;
            const offerTitle = offer.title.toLowerCase();
            
            let profileMatch = 0;
            if (profileKeywords[candidateProfile]) {
                const keywords = profileKeywords[candidateProfile];
                const matches = keywords.filter(keyword => 
                    offerTitle.includes(keyword.toLowerCase())
                );
                profileMatch = (matches.length / keywords.length) * 20;
            }
            
            score += profileMatch;
            
            // 3. Correspondance télétravail (10% du score)
            if (offer.remote === 'full') {
                score += 10; // Le candidat peut toujours travailler à distance
            } else if (offer.remote === 'partial') {
                score += 5;
            }
            
            // 4. Localisation (10% du score) - simplifiée pour la démo
            const candidateDept = candidate.department.toLowerCase();
            const offerLocation = offer.location.toLowerCase();
            
            // Si le candidat est dans la même région ou l'offre est en remote
            if (offerLocation.includes('remote') || 
                candidateDept.includes(offerLocation) || 
                offerLocation.includes(candidateDept)) {
                score += 10;
            } else if (offer.remote !== 'none') {
                score += 5; // Télétravail partiel
            }
            
            // 5. Expérience (10% du score) - basée sur le nombre de technologies maîtrisées
            const expFactor = Math.min(candidate.technologies.length / 10, 1) * 10;
            score += expFactor;
            
            // S'assurer que le score est entre 0 et 100
            return Math.min(Math.round(score), 100);
        }

        // Analyser les facteurs de matching
        function analyzeMatchingFactors(candidate, offer) {
            const factors = [];
            
            // Technologies communes
            const candidateTechs = candidate.technologies.map(t => t.toLowerCase());
            const offerTechs = offer.technologies.map(t => t.toLowerCase());
            const commonTechs = offerTechs.filter(tech => 
                candidateTechs.some(cTech => cTech.includes(tech) || tech.includes(cTech))
            );
            
            if (commonTechs.length > 0) {
                factors.push(`${commonTechs.length} technologie(s) correspondante(s) : ${commonTechs.join(', ')}`);
            }
            
            // Profil correspondant
            const offerTitle = offer.title.toLowerCase();
            const candidateProfile = candidate.profile.toLowerCase();
            
            if (offerTitle.includes(candidateProfile) || candidateProfile.includes(offerTitle)) {
                factors.push("Profil correspondant");
            }
            
            // Télétravail
            if (offer.remote === 'full') {
                factors.push("Télétravail complet possible");
            } else if (offer.remote === 'partial') {
                factors.push("Télétravail partiel possible");
            }
            
            return factors;
        }

        // Afficher les résultats du matching
        function showMatchingResults() {
            if (currentMatchingResults.length === 0) {
                showNotification('Aucune correspondance trouvée', 'info');
                return;
            }
            
            const modalTitle = document.getElementById('matchingModalTitle');
            const modalContent = document.getElementById('matchingDetailsContent');
            
            modalTitle.textContent = `Résultats du matching IA (${currentMatchingResults.length} correspondances)`;
            
            // Grouper par candidat
            const byCandidate = {};
            currentMatchingResults.forEach(result => {
                if (!byCandidate[result.candidateId]) {
                    byCandidate[result.candidateId] = {
                        name: result.candidateName,
                        matches: []
                    };
                }
                byCandidate[result.candidateId].matches.push({
                    offerTitle: result.offerTitle,
                    score: result.matchScore,
                    factors: result.matchingFactors
                });
            });
            
            // Grouper par offre
            const byOffer = {};
            currentMatchingResults.forEach(result => {
                if (!byOffer[result.offerId]) {
                    byOffer[result.offerId] = {
                        title: result.offerTitle,
                        matches: []
                    };
                }
                byOffer[result.offerId].matches.push({
                    candidateName: result.candidateName,
                    score: result.matchScore
                });
            });
            
            // Construire le contenu HTML
            let html = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-3">
                            <div class="card-header bg-primary text-white">
                                <i class="fas fa-user-friends me-2"></i> Par candidat
                            </div>
                            <div class="card-body">
            `;
            
            Object.values(byCandidate).forEach(candidate => {
                html += `
                    <div class="mb-3">
                        <h6>${candidate.name}</h6>
                        <ul class="list-group">
                `;
                
                candidate.matches.sort((a, b) => b.score - a.score).forEach(match => {
                    const matchClass = getMatchClass(match.score);
                    html += `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${match.offerTitle}</strong>
                                <div class="small text-muted">
                                    ${match.factors.slice(0, 2).join(', ')}
                                </div>
                            </div>
                            <span class="${matchClass}">${match.score}%</span>
                        </li>
                    `;
                });
                
                html += `</ul></div>`;
            });
            
            html += `
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <i class="fas fa-briefcase me-2"></i> Par offre
                            </div>
                            <div class="card-body">
            `;
            
            Object.values(byOffer).forEach(offer => {
                html += `
                    <div class="mb-3">
                        <h6>${offer.title}</h6>
                        <ul class="list-group">
                `;
                
                offer.matches.sort((a, b) => b.score - a.score).forEach(match => {
                    const matchClass = getMatchClass(match.score);
                    html += `
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>${match.candidateName}</span>
                            <span class="${matchClass}">${match.score}%</span>
                        </li>
                    `;
                });
                
                html += `</ul></div>`;
            });
            
            html += `
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-3 text-center">
                    <p class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        L'algorithme IA analyse les technologies, le profil, la localisation et le télétravail.
                    </p>
                </div>
            `;
            
            modalContent.innerHTML = html;
            
            // Afficher le modal
            const modal = new bootstrap.Modal(document.getElementById('matchingDetailsModal'));
            modal.show();
        }

        // Obtenir la classe CSS pour le pourcentage de matching
        function getMatchClass(percentage) {
            if (percentage >= 70) return 'match-high';
            if (percentage >= 40) return 'match-medium';
            return 'match-low';
        }

        // Ajouter une nouvelle offre
        function addOffer(e) {
            e.preventDefault();
            
            const title = document.getElementById('offerTitle').value;
            const location = document.getElementById('offerLocation').value;
            const salary = document.getElementById('offerSalary').value;
            const technologies = document.getElementById('offerTechnologies').value
                .split(',')
                .map(t => t.trim())
                .filter(t => t.length > 0);
            const remote = document.getElementById('offerRemote').value;
            const link = document.getElementById('offerLink').value;
            const company = document.getElementById('offerCompany').value;
            const description = document.getElementById('offerDescription').value;
            
            // Créer un nouvel ID
            const newId = offers.length > 0 ? Math.max(...offers.map(o => o.id)) + 1 : 1;
            
            // Créer l'objet offre
            const newOffer = {
                id: newId,
                title,
                location,
                salary,
                technologies,
                remote,
                company,
                link,
                description,
                proposedProfiles: 0,
                matchPercentage: 0,
                dateAdded: new Date().toISOString()
            };
            
            // Ajouter à la liste
            offers.push(newOffer);
            
            // Mettre à jour le tableau
            renderOffersTable();
            
            // Fermer le modal
            bootstrap.Modal.getInstance(document.getElementById('addOfferModal')).hide();
            
            // Réinitialiser le formulaire
            document.getElementById('addOfferForm').reset();
            
            // Afficher une notification
            showNotification(`Offre "${title}" ajoutée avec succès`, 'success');
            
            // Dans une vraie application, on enregistrerait dans Firebase
            console.log('Offre à enregistrer dans Firebase:', newOffer);
        }

        // Ajouter un nouveau candidat
        function addCandidate(e) {
            e.preventDefault();
            
            const firstName = document.getElementById('candidateFirstName').value;
            const lastName = document.getElementById('candidateLastName').value;
            const phone = document.getElementById('candidatePhone').value;
            const email = document.getElementById('candidateEmail').value;
            const department = document.getElementById('candidateDepartment').value;
            const profile = document.getElementById('candidateProfile').value;
            const technologies = document.getElementById('candidateTechnologies').value
                .split(',')
                .map(t => t.trim())
                .filter(t => t.length > 0);
            const cv = document.getElementById('candidateCV').value;
            const experience = document.getElementById('candidateExperience').value;
            
            // Créer un nouvel ID
            const newId = candidates.length > 0 ? Math.max(...candidates.map(c => c.id)) + 1 : 1;
            
            // Créer l'objet candidat
            const newCandidate = {
                id: newId,
                firstName,
                lastName,
                phone,
                email,
                department,
                profile,
                technologies,
                cv,
                experience,
                potentialOffers: 0,
                matchPercentage: 0,
                dateAdded: new Date().toISOString()
            };
            
            // Ajouter à la liste
            candidates.push(newCandidate);
            
            // Mettre à jour le tableau
            renderCandidatesTable();
            
            // Fermer le modal
            bootstrap.Modal.getInstance(document.getElementById('addCandidateModal')).hide();
            
            // Réinitialiser le formulaire
            document.getElementById('addCandidateForm').reset();
            
            // Afficher une notification
            showNotification(`Candidat "${firstName} ${lastName}" ajouté avec succès`, 'success');
            
            // Dans une vraie application, on enregistrerait dans Firebase
            console.log('Candidat à enregistrer dans Firebase:', newCandidate);
        }

        // Voir les détails d'une offre
        function viewOfferDetails(offerId) {
            const offer = offers.find(o => o.id === offerId);
            if (!offer) return;
            
            const modalTitle = document.getElementById('matchingModalTitle');
            const modalContent = document.getElementById('matchingDetailsContent');
            
            modalTitle.textContent = `Détails de l'offre : ${offer.title}`;
            
            const remoteText = offer.remote === 'full' ? 'Télétravail complet' :
                             offer.remote === 'partial' ? 'Télétravail partiel' : 'Sur site';
            
            const techBadges = offer.technologies.map(tech => 
                `<span class="tech-badge">${tech}</span>`
            ).join('');
            
            modalContent.innerHTML = `
                <div class="row">
                    <div class="col-md-8">
                        <h5>${offer.title}</h5>
                        <p><strong>Entreprise:</strong> ${offer.company || 'Non spécifié'}</p>
                        <p><strong>Localisation:</strong> ${offer.location}</p>
                        <p><strong>Salaire/TJM:</strong> ${offer.salary}</p>
                        <p><strong>Télétravail:</strong> ${remoteText}</p>
                        <p><strong>Description:</strong> ${offer.description || 'Non disponible'}</p>
                        <p><strong>Technologies requises:</strong></p>
                        <div class="mb-3">${techBadges}</div>
                        <p><strong>Lien externe:</strong> <a href="${offer.link}" target="_blank">${offer.link}</a></p>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <i class="fas fa-chart-line me-2"></i> Statistiques
                            </div>
                            <div class="card-body text-center">
                                <h1 class="display-4 ${getMatchClass(offer.matchPercentage)}">${offer.matchPercentage}%</h1>
                                <p class="text-muted">Score de matching</p>
                                <div class="mt-3">
                                    <span class="badge bg-primary rounded-pill p-2 fs-6">${offer.proposedProfiles} profils</span>
                                    <p class="small mt-2">Candidats correspondants</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-3 text-center">
                    <button class="btn btn-primary" onclick="findCandidatesForOffer(${offerId})">
                        <i class="fas fa-search me-2"></i> Trouver des candidats pour cette offre
                    </button>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('matchingDetailsModal'));
            modal.show();
        }

        // Voir les détails d'un candidat
        function viewCandidateDetails(candidateId) {
            const candidate = candidates.find(c => c.id === candidateId);
            if (!candidate) return;
            
            const modalTitle = document.getElementById('matchingModalTitle');
            const modalContent = document.getElementById('matchingDetailsContent');
            
            modalTitle.textContent = `Détails du candidat : ${candidate.firstName} ${candidate.lastName}`;
            
            const techBadges = candidate.technologies.map(tech => 
                `<span class="tech-badge">${tech}</span>`
            ).join('');
            
            modalContent.innerHTML = `
                <div class="row">
                    <div class="col-md-8">
                        <h5>${candidate.firstName} ${candidate.lastName}</h5>
                        <p><strong>Profil:</strong> ${candidate.profile}</p>
                        <p><strong>Téléphone:</strong> ${candidate.phone}</p>
                        <p><strong>Email:</strong> ${candidate.email}</p>
                        <p><strong>Département/Région:</strong> ${candidate.department}</p>
                        <p><strong>Expérience:</strong> ${candidate.experience} ans</p>
                        <p><strong>CV:</strong> <a href="${candidate.cv}" target="_blank">${candidate.cv}</a></p>
                        <p><strong>Technologies maîtrisées:</strong></p>
                        <div class="mb-3">${techBadges}</div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <i class="fas fa-chart-line me-2"></i> Statistiques
                            </div>
                            <div class="card-body text-center">
                                <h1 class="display-4 ${getMatchClass(candidate.matchPercentage)}">${candidate.matchPercentage}%</h1>
                                <p class="text-muted">Score de matching</p>
                                <div class="mt-3">
                                    <span class="badge bg-primary rounded-pill p-2 fs-6">${candidate.potentialOffers} offres</span>
                                    <p class="small mt-2">Offres correspondantes</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-3 text-center">
                    <button class="btn btn-primary" onclick="findOffersForCandidate(${candidateId})">
                        <i class="fas fa-search me-2"></i> Trouver des offres pour ce candidat
                    </button>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('matchingDetailsModal'));
            modal.show();
        }

        // Trouver des candidats pour une offre spécifique
        function findCandidatesForOffer(offerId) {
            const offer = offers.find(o => o.id === offerId);
            if (!offer) return;
            
            // Calculer les matchings pour cette offre spécifique
            const candidateMatches = candidates.map(candidate => {
                const score = calculateMatchScore(candidate, offer);
                const factors = analyzeMatchingFactors(candidate, offer);
                return { candidate, score, factors };
            }).filter(match => match.score > 40) // Seuil de 40%
              .sort((a, b) => b.score - a.score);
            
            // Afficher les résultats
            const modalTitle = document.getElementById('matchingModalTitle');
            const modalContent = document.getElementById('matchingDetailsContent');
            
            modalTitle.textContent = `Candidats pour : ${offer.title}`;
            
            if (candidateMatches.length === 0) {
                modalContent.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
                        <h5>Aucun candidat ne correspond à cette offre</h5>
                        <p class="text-muted">Essayez d'ajouter plus de candidats ou de relancer le matching IA.</p>
                    </div>
                `;
            } else {
                let html = `
                    <h5 class="mb-3">${candidateMatches.length} candidat(s) correspondant(s)</h5>
                    <div class="list-group">
                `;
                
                candidateMatches.forEach(match => {
                    const matchClass = getMatchClass(match.score);
                    html += `
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6>${match.candidate.firstName} ${match.candidate.lastName}</h6>
                                    <p class="mb-1">${match.candidate.profile} - ${match.candidate.email}</p>
                                    <p class="small text-muted mb-1">
                                        <strong>Correspondances:</strong> ${match.factors.slice(0, 3).join(', ')}
                                    </p>
                                    <div>
                                        ${match.candidate.technologies.map(tech => 
                                            `<span class="tech-badge small">${tech}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                                <div class="text-end">
                                    <span class="${matchClass} fs-5">${match.score}%</span>
                                    <div class="mt-2">
                                        <a href="${match.candidate.cv}" target="_blank" class="btn btn-sm btn-outline-success">
                                            <i class="fas fa-file-pdf"></i> CV
                                        </a>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewCandidateDetails(${match.candidate.id})">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
                modalContent.innerHTML = html;
            }
            
            const modal = new bootstrap.Modal(document.getElementById('matchingDetailsModal'));
            modal.show();
        }

        // Trouver des offres pour un candidat spécifique
        function findOffersForCandidate(candidateId) {
            const candidate = candidates.find(c => c.id === candidateId);
            if (!candidate) return;
            
            // Calculer les matchings pour ce candidat spécifique
            const offerMatches = offers.map(offer => {
                const score = calculateMatchScore(candidate, offer);
                const factors = analyzeMatchingFactors(candidate, offer);
                return { offer, score, factors };
            }).filter(match => match.score > 40) // Seuil de 40%
              .sort((a, b) => b.score - a.score);
            
            // Afficher les résultats
            const modalTitle = document.getElementById('matchingModalTitle');
            const modalContent = document.getElementById('matchingDetailsContent');
            
            modalTitle.textContent = `Offres pour : ${candidate.firstName} ${candidate.lastName}`;
            
            if (offerMatches.length === 0) {
                modalContent.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-briefcase fa-3x text-muted mb-3"></i>
                        <h5>Aucune offre ne correspond à ce candidat</h5>
                        <p class="text-muted">Essayez d'ajouter plus d'offres ou de relancer le matching IA.</p>
                    </div>
                `;
            } else {
                let html = `
                    <h5 class="mb-3">${offerMatches.length} offre(s) correspondante(s)</h5>
                    <div class="list-group">
                `;
                
                offerMatches.forEach(match => {
                    const matchClass = getMatchClass(match.score);
                    const remoteBadge = match.offer.remote === 'full' 
                        ? '<span class="status-badge remote-badge small">Remote</span>'
                        : match.offer.remote === 'partial' 
                        ? '<span class="status-badge remote-badge small">Hybride</span>'
                        : '<span class="status-badge onsite-badge small">Sur site</span>';
                    
                    html += `
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6>${match.offer.title}</h6>
                                    <p class="mb-1">${match.offer.company || ''} - ${match.offer.location} - ${match.offer.salary} ${remoteBadge}</p>
                                    <p class="small text-muted mb-1">
                                        <strong>Correspondances:</strong> ${match.factors.slice(0, 3).join(', ')}
                                    </p>
                                    <div>
                                        ${match.offer.technologies.map(tech => 
                                            `<span class="tech-badge small">${tech}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                                <div class="text-end">
                                    <span class="${matchClass} fs-5">${match.score}%</span>
                                    <div class="mt-2">
                                        <a href="${match.offer.link}" target="_blank" class="btn btn-sm btn-outline-info">
                                            <i class="fas fa-external-link-alt"></i> Offre
                                        </a>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewOfferDetails(${match.offer.id})">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
                modalContent.innerHTML = html;
            }
            
            const modal = new bootstrap.Modal(document.getElementById('matchingDetailsModal'));
            modal.show();
        }

        // Afficher une notification
        function showNotification(message, type = 'info') {
            // Créer une alerte Bootstrap
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = `
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            // Supprimer automatiquement après 5 secondes
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // Exposer les fonctions globalement pour les boutons onclick
        window.viewOfferDetails = viewOfferDetails;
        window.viewCandidateDetails = viewCandidateDetails;
        window.findCandidatesForOffer = findCandidatesForOffer;
        window.findOffersForCandidate = findOffersForCandidate;
    </script>
</body>
</html>