<!DOCTYPE html>
<html>
<head>
    <title>Test Firebase Connexion</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .container {
            border: 2px solid #333;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        
        button:hover {
            background: #3367d6;
        }
        
        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: monospace;
            font-size: 14px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .info-box {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border: 1px solid #b3d7ff;
        }
        
        .data-section {
            margin-top: 20px;
        }
        
        .data-item {
            background: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-left: 4px solid #4285f4;
        }
        
        h3 {
            color: #333;
            border-bottom: 2px solid #4285f4;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <h2>üîç Test Connexion Firebase</h2>
    
    <div class="info-box">
        <strong>Configuration utilis√©e :</strong><br>
        Projet: <code>dddiii-2b58b</code><br>
        Email: <code>g.marouane@outlook.fr</code><br>
        R√©gion DB: <code>asia-southeast1</code>
    </div>
    
    <button onclick="testerConnexion()">üîó TESTER LA CONNEXION ET LIRE LES DONN√âES</button>
    
    <div id="result"></div>
    
    <div id="dataDisplay" class="data-section"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // VOTRE CONFIGURATION EXACTE
        const firebaseConfig = {
            apiKey: "AIzaSyC6uSDTNCuw5sHNVaNgq0EzJqJZ9jgic7U",
            authDomain: "dddiii-2b58b.firebaseapp.com",
            databaseURL: "https://dddiii-2b58b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "dddiii-2b58b",
            storageBucket: "dddiii-2b58b.firebasestorage.app",
            messagingSenderId: "721468171485",
            appId: "1:721468171485:web:420e2e0ab98b95fa2ae734",
            measurementId: "G-QGFM2N76VK"
        };

        let auth = null;
        let database = null;

        async function testerConnexion() {
            const resultDiv = document.getElementById('result');
            const dataDiv = document.getElementById('dataDisplay');
            
            // R√©initialiser l'affichage
            resultDiv.innerHTML = "";
            dataDiv.innerHTML = "";
            resultDiv.className = "loading";
            
            try {
                // √âtape 1: Initialiser Firebase
                resultDiv.innerHTML = "1. Initialisation de Firebase...\n";
                
                // Fermer les anciennes instances
                if (firebase.apps.length > 0) {
                    await Promise.all(firebase.apps.map(app => app.delete()));
                }
                
                // Initialiser avec votre config
                const app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                database = firebase.database();
                
                resultDiv.innerHTML += "‚úì Firebase initialis√©\n";
                resultDiv.innerHTML += "2. Connexion avec les identifiants...\n";
                
                // √âtape 2: Connexion avec email/mot de passe
                const email = "g.marouane@outlook.fr";
                const password = "M@ra10";
                
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                resultDiv.innerHTML += `‚úì Connect√© avec succ√®s!\n`;
                resultDiv.innerHTML += `   UID: ${user.uid}\n`;
                resultDiv.innerHTML += `   Email: ${user.email}\n`;
                resultDiv.innerHTML += `   Email v√©rifi√©: ${user.emailVerified}\n`;
                resultDiv.innerHTML += "3. Lecture de la base de donn√©es...\n";
                
                // √âtape 3: Lire TOUTES les donn√©es
                const snapshot = await database.ref('/').once('value');
                
                if (snapshot.exists()) {
                    const allData = snapshot.val();
                    resultDiv.innerHTML += `‚úì Donn√©es trouv√©es!\n`;
                    resultDiv.innerHTML += `   Nombre d'√©l√©ments: ${Object.keys(allData).length}\n\n`;
                    
                    // Afficher les donn√©es de mani√®re organis√©e
                    dataDiv.innerHTML = '<h3>üìä DONN√âES DE LA BASE :</h3>';
                    
                    Object.keys(allData).forEach(key => {
                        const value = allData[key];
                        const dataItem = document.createElement('div');
                        dataItem.className = 'data-item';
                        
                        if (typeof value === 'object' && value !== null) {
                            dataItem.innerHTML = `
                                <strong>${key}:</strong><br>
                                <pre>${JSON.stringify(value, null, 2)}</pre>
                            `;
                        } else {
                            dataItem.innerHTML = `<strong>${key}:</strong> ${value}`;
                        }
                        
                        dataDiv.appendChild(dataItem);
                    });
                    
                    // Afficher aussi le JSON brut
                    const rawDataDiv = document.createElement('div');
                    rawDataDiv.className = 'data-item';
                    rawDataDiv.innerHTML = `
                        <strong>JSON Complet :</strong><br>
                        <pre>${JSON.stringify(allData, null, 2)}</pre>
                    `;
                    dataDiv.appendChild(rawDataDiv);
                    
                    resultDiv.className = "success";
                    
                } else {
                    resultDiv.innerHTML += "‚úì Connexion DB r√©ussie mais aucune donn√©e trouv√©e\n";
                    dataDiv.innerHTML = '<h3>‚ÑπÔ∏è Base de donn√©es vide</h3>';
                    resultDiv.className = "success";
                }
                
            } catch (error) {
                // Afficher l'erreur d√©taill√©e
                resultDiv.innerHTML = `‚ùå ERREUR:\n`;
                resultDiv.innerHTML += `Code: ${error.code || 'N/A'}\n`;
                resultDiv.innerHTML += `Message: ${error.message}\n\n`;
                
                // Diagnostic selon le type d'erreur
                resultDiv.innerHTML += `üîç DIAGNOSTIC:\n`;
                
                if (error.code === 'auth/invalid-api-key') {
                    resultDiv.innerHTML += `- La cl√© API est invalide\n`;
                    resultDiv.innerHTML += `- V√©rifiez: ${firebaseConfig.apiKey.substring(0, 20)}...\n`;
                } 
                else if (error.code === 'auth/user-not-found') {
                    resultDiv.innerHTML += `- L'utilisateur n'existe pas\n`;
                    resultDiv.innerHTML += `- Cr√©ez-le dans Firebase Console ‚Üí Authentication\n`;
                }
                else if (error.code === 'auth/wrong-password') {
                    resultDiv.innerHTML += `- Mot de passe incorrect\n`;
                }
                else if (error.code === 'auth/network-request-failed') {
                    resultDiv.innerHTML += `- Probl√®me r√©seau\n`;
                    resultDiv.innerHTML += `- V√©rifiez votre connexion internet\n`;
                }
                else if (error.message.includes('permission_denied')) {
                    resultDiv.innerHTML += `- Permission refus√©e par les r√®gles de s√©curit√©\n`;
                    resultDiv.innerHTML += `- Allez sur Firebase Console ‚Üí Realtime Database ‚Üí R√®gles\n`;
                    resultDiv.innerHTML += `- Utilisez temporairement:\n`;
                    resultDiv.innerHTML += `{\n  "rules": {\n    ".read": true,\n    ".write": false\n  }\n}\n`;
                }
                else {
                    resultDiv.innerHTML += `- Erreur inconnue: ${error.message}\n`;
                }
                
                resultDiv.innerHTML += `\nüìã CONFIG UTILIS√âE:\n`;
                resultDiv.innerHTML += JSON.stringify(firebaseConfig, null, 2);
                
                resultDiv.className = "error";
                
                console.error("Erreur compl√®te:", error);
            }
        }

        // Message d'accueil
        document.getElementById('result').innerHTML = 
            "Cliquez sur le bouton pour tester la connexion Firebase\n" +
            "et lire toutes les donn√©es de la base.\n\n" +
            "‚û°Ô∏è V√©rifiera: 1. Cl√© API 2. Authentification 3. R√®gles DB 4. Donn√©es";
        document.getElementById('result').className = "info-box";
    </script>
</body>
</html>